# –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ –∫ –∑–∞–Ω—è—Ç–∏—é ¬´–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Terraform –≤ –∫–æ–º–∞–Ω–¥–µ¬ª

wget https://releases.hashicorp.com/terraform/1.12.0/terraform_1.12.0_linux_amd64.zip
unzip terraform_1.12.0_linux_amd64.zip
sudo mv terraform /usr/local/bin/


### –¶–µ–ª–∏ –∑–∞–¥–∞–Ω–∏—è

1. –ù–∞—É—á–∏—Ç—å—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å remote state —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º–∏.
2. –û—Å–≤–æ–∏—Ç—å –ø—Ä–∏—ë–º—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Ä–∞–±–æ—Ç—ã.


### –ß–µ–∫-–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ –¥–æ–º–∞—à–Ω–µ–º—É –∑–∞–¥–∞–Ω–∏—é

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –∞–∫–∫–∞—É–Ω—Ç –≤ Yandex Cloud. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –ø—Ä–æ–º–æ–∫–æ–¥ –Ω–∞ –≥—Ä–∞–Ω—Ç.
2. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç Yandex CLI.
3. –õ—é–±—ã–µ –í–ú, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–¥–∞–Ω–∏—è, –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—Ä–µ—Ä—ã–≤–∞–µ–º—ã–º–∏, –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ —Å—Ä–µ–¥—Å—Ç–≤.

------
### –í–Ω–∏–º–∞–Ω–∏–µ!! –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–ª—É—á–∏–≤—à–∏–π—Å—è –∫–æ–¥ –≤ –≤–∏–¥–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤–∞—à github-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π!
–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤–∞—à–∞ –≤–µ—Ä—Å–∏—è **Terraform** ~>1.12.0
–ü–∏—à–µ–º –∫—Ä–∞—Å–∏–≤—ã–π –∫–æ–¥, —Ö–∞—Ä–¥–∫–æ–¥ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–µ –¥–æ–ø—É—Å—Ç–∏–º—ã!

------
### –ó–∞–¥–∞–Ω–∏–µ 0
1. –ü—Ä–æ—á—Ç–∏—Ç–µ —Å—Ç–∞—Ç—å—é: https://neprivet.com/
2. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–∏—Ç–µ –¥–∞–Ω–Ω—É—é –∏–¥–µ—é –≤ —Å–≤–æ–µ–º –∫–æ–ª–ª–µ–∫—Ç–∏–≤–µ.

------

### –ó–∞–¥–∞–Ω–∏–µ 1

1. –í–æ–∑—å–º–∏—Ç–µ –∫–æ–¥:
- –∏–∑ [–î–ó –∫ –ª–µ–∫—Ü–∏–∏ 4](https://github.com/netology-code/ter-homeworks/tree/main/04/src),
- –∏–∑ [–¥–µ–º–æ –∫ –ª–µ–∫—Ü–∏–∏ 4](https://github.com/netology-code/ter-homeworks/tree/main/04/demonstration1).
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–¥ —Å –ø–æ–º–æ—â—å—é tflint –∏ checkov. –í–∞–º –Ω–µ –Ω—É–∂–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç.
3. –ü–µ—Ä–µ—á–∏—Å–ª–∏—Ç–µ, –∫–∞–∫–∏–µ **—Ç–∏–ø—ã** –æ—à–∏–±–æ–∫ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã –≤ –ø—Ä–æ–µ–∫—Ç–µ (–±–µ–∑ –¥—É–±–ª–µ–π).

------
https://github.com/netology-code/ter-homeworks/tree/main/04/src

1.2 –ü—Ä–æ–≤–µ—Ä–∫–∞ tflint (—Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫)

echo "=== TFLint Check ==="
tflint

#providers.tf  –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤–µ—Ä—Å–∏—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
variable "vms_ssh_root_key" is declared but not used variable "vm_web_name" is declared but not used variable 


#variables.tf -–Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
"vm_db_name" is declared but not used


‚úÖ main.tf - —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π, —Ä–µ—Å—É—Ä—Å—ã –æ–±—ä—è–≤–ª–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
‚úÖ outputs.tf - —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –Ω–æ –ø—É—Å—Ç–æ–π (—ç—Ç–æ –Ω–µ –æ—à–∏–±–∫–∞)
‚úÖ .gitignore - —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
‚úÖ .terraformrc - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞


echo -e "\n=== Checkov Check ===" (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –Ω–∞—Ä—É—à–µ–Ω–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
checkov -d .   
checkov -d . --skip-download

Checkov –≤—ã–ø–æ–ª–Ω–∏–ª —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, –Ω–æ –Ω–µ –≤—ã–≤–µ–ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã. –≠—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –æ–Ω –Ω–µ –Ω–∞—à–µ–ª –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –Ω–∞—Ä—É—à–µ–Ω–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

‚úÖ –ù–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
‚úÖ –ù–µ—Ç —Å–µ—Ä—å–µ–∑–Ω—ã—Ö –Ω–∞—Ä—É—à–µ–Ω–∏–π best practices
‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ —Ü–µ–ª–æ–º –±–µ–∑–æ–ø–∞—Å–Ω–∞

------------------------------
https://github.com/netology-code/ter-homeworks/tree/main/04/demonstration1

tflint –Ω–∏—á–µ–≥–æ –Ω–µ –≤—ã–≤–µ–ª:
= –Ω–µ—Ç —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ ‚úÖ

–û—à–∏–±–∫–∏, –Ω–∞–π–¥–µ–Ω–Ω—ã–µ checkov:
4 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
CKV_TF_1 √ó2 - "Ensure Terraform module sources use a commit hash"
CKV_TF_2 √ó2 - "Ensure Terraform module sources use a tag with a version number"

–ü—Ä–æ–±–ª–µ–º–∞:
–ú–æ–¥—É–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø–ª–∞–≤–∞—é—â–∏–µ —Å—Å—ã–ª–∫–∏:
hcl
source = "git::https://github.com/udjin10/yandex_compute_instance.git?ref=main"
–†–∏—Å–∫–∏:
–ö–æ–¥ –≤ –≤–µ—Ç–∫–µ main –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è –∏ —Å–ª–æ–º–∞—Ç—å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É
–ù–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
–í–æ–∑–º–æ–∂–Ω—ã –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ø–æ–≤–µ–¥–µ–Ω–∏–∏

–†–µ—à–µ–Ω–∏–µ:
–ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é:

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ–≥
source = "git::https://github.com/udjin10/yandex_compute_instance.git?ref=v1.2.3"

# –∫–æ–º–º–∏—Ç
source = "git::https://github.com/udjin10/yandex_compute_instance.git?ref=abc123def456"

–ò—Ç–æ–≥ –ø–æ demonstration1:
–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç	–†–µ–∑—É–ª—å—Ç–∞—Ç
tflint	‚úÖ –ù–µ—Ç —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫
checkov	‚ùå 4 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ security issues

Checkov –Ω–∞—à–µ–ª –æ—à–∏–±–∫–∏ –≤ —Ñ–∞–π–ª–µ: /vms/main.tf

–ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –æ—à–∏–±–æ–∫:
–§–∞–π–ª: ~/terraform-project/ter-homeworks/04/demonstration1/vms/main.tf
–û—à–∏–±–∫–∏:
–ú–æ–¥—É–ª—å test-vm (—Å—Ç—Ä–æ–∫–∏ 22-43) - 2 –Ω–∞—Ä—É—à–µ–Ω–∏—è
–°—Ç—Ä–æ–∫–∏ 22-43 - –º–æ–¥—É–ª—å test-vm:
‚ùå CKV_TF_1 - –Ω–µ—Ç —Ö–µ—à–∞ –∫–æ–º–º–∏—Ç–∞
‚ùå CKV_TF_2 - –Ω–µ—Ç –≤–µ—Ä—Å–∏–æ–Ω–Ω–æ–≥–æ —Ç–µ–≥–∞

–ú–æ–¥—É–ª—å example-vm (—Å—Ç—Ä–æ–∫–∏ 45-61) - 2 –Ω–∞—Ä—É—à–µ–Ω–∏—è
–°—Ç—Ä–æ–∫–∏ 45-61 - –º–æ–¥—É–ª—å example-vm:
‚ùå CKV_TF_1 - –Ω–µ—Ç —Ö–µ—à–∞ –∫–æ–º–º–∏—Ç–∞
‚ùå CKV_TF_2 - –Ω–µ—Ç –≤–µ—Ä—Å–∏–æ–Ω–Ω–æ–≥–æ —Ç–µ–≥–∞

–ü—Ä–æ–±–ª–µ–º–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –≤ –æ–±–æ–∏—Ö –º–æ–¥—É–ª—è—Ö: 
source = "git::https://github.com/udjin10/yandex_compute_instance.git?ref=main"
–ò—Ç–æ–≥–æ:
2 –º–æ–¥—É–ª—è √ó 2 –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –∫–∞–∂–¥—ã–π = 4 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ vms/main.tf


–ò—Ç–æ–≥–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ:
2 —Ç–∏–ø–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
4 —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –Ω–∞—Ä—É—à–µ–Ω–∏–π –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ
0 —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ (tflint –Ω–µ –Ω–∞—à–µ–ª –ø—Ä–æ–±–ª–µ–º)

–í—Å–µ –æ—à–∏–±–∫–∏ –æ—Ç–Ω–æ—Å—è—Ç—Å—è –∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ best practices –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Terraform –º–æ–¥—É–ª–µ–π.
========================================

1.3. –ü–µ—Ä–µ—á–∏—Å–ª–∏—Ç–µ, –∫–∞–∫–∏–µ **—Ç–∏–ø—ã** –æ—à–∏–±–æ–∫ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã –≤ –ø—Ä–æ–µ–∫—Ç–µ

------------------
–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏, –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ –≤ –ø—Ä–æ–µ–∫—Ç–µ:
–í –≤–µ—Ç–∫–µ main/04/src:
tflint –Ω–∞—à–µ–ª:
–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–µ—Ä—Å–∏–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ Yandex –≤ required_providers
–ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ: 
vms_ssh_root_key, 
vm_web_name,
 vm_db_name

checkov –Ω–∞—à–µ–ª:
‚ùå –ù–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –Ω–∞—Ä—É—à–µ–Ω–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

–í –≤–µ—Ç–∫–µ demonstration1:
tflint –Ω–∞—à–µ–ª:
‚úÖ –ù–µ—Ç —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫

checkov –Ω–∞—à–µ–ª:
–¢–∏–ø—ã –æ—à–∏–±–æ–∫, –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –≤ –ø—Ä–æ–µ–∫—Ç–µ demonstration1:
1. –ü—Ä–æ–±–ª–µ–º—ã –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–¥—É–ª–µ–π (Security)
CKV_TF_1 - –ú–æ–¥—É–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ö–µ—à –∫–æ–º–º–∏—Ç–∞
CKV_TF_2 - –ú–æ–¥—É–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –≤–µ—Ä—Å–∏–æ–Ω–Ω—ã–µ —Ç–µ–≥–∏

2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–ª–∞–≤–∞—é—â–∏—Ö —Å—Å—ã–ª–æ–∫ (Best Practice)
–ú–æ–¥—É–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –≤–µ—Ç–∫—É main –≤–º–µ—Å—Ç–æ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏

–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≥–∞—Ä–∞–Ω—Ç–∏–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç–∏ - —Ä–∏—Å–∫ –Ω–µ–∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π



============






### –ó–∞–¥–∞–Ω–∏–µ 2

1. –í–æ–∑—å–º–∏—Ç–µ –≤–∞—à GitHub-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å **–≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–º –î–ó 4** –≤ –≤–µ—Ç–∫–µ 'terraform-04' –∏ —Å–¥–µ–ª–∞–π—Ç–µ –∏–∑ –Ω–µ–≥–æ –≤–µ—Ç–∫—É 'terraform-05'.
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ remote state —Å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º–∏:
   - –°–æ–∑–¥–∞–π—Ç–µ S3 bucket –≤ Yandex Cloud –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è state (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–Ω)
   - –°–æ–∑–¥–∞–π—Ç–µ service account —Å –ø—Ä–∞–≤–∞–º–∏ –Ω–∞ —á—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å –≤ bucket
   - –ù–∞—Å—Ç—Ä–æ–π—Ç–µ backend –≤ providers.tf —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –Ω–æ–≤–æ–≥–æ –º–µ—Ö–∞–Ω–∏–∑–º–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫:
     ```hcl
     terraform {
       required_version = "~>1.12.0"
       
       backend "s3" {
         bucket  = "–≤–∞—à-bucket-name"
         key     = "terraform.tfstate"
         region  = "ru-central1"
         
         # –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ (Terraform >= 1.6)
         # –ù–µ —Ç—Ä–µ–±—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö!
         use_lockfile = true
         
         endpoints = {
           s3 = "https://storage.yandexcloud.net"
         }
         
         skip_region_validation      = true
         skip_credentials_validation = true
         skip_requesting_account_id  = true
         skip_s3_checksum            = true
       }
     }
     ```
   - –í—ã–ø–æ–ª–Ω–∏—Ç–µ `terraform init -migrate-state` –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏ state –≤ S3
   - –ü—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –ø—Ä–æ—Ü–µ—Å—Å–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –º–∏–≥—Ä–∞—Ü–∏–∏
3. –ó–∞–∫–æ–º–º–∏—Ç—å—Ç–µ –≤ –≤–µ—Ç–∫—É 'terraform-05' –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è.
4. –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –ø—Ä–æ–µ–∫—Ç–µ terraform console, –∞ –≤ –¥—Ä—É–≥–æ–º –æ–∫–Ω–µ –∏–∑ —ç—Ç–æ–π –∂–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å terraform apply.
5. –ü—Ä–∏—à–ª–∏—Ç–µ –æ—Ç–≤–µ—Ç –æ–± –æ—à–∏–±–∫–µ –¥–æ—Å—Ç—É–ø–∞ –∫ state (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–æ–ª–∂–Ω–∞ —Å—Ä–∞–±–æ—Ç–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏).
6. –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–π—Ç–µ state –∫–æ–º–∞–Ω–¥–æ–π `terraform force-unlock <LOCK_ID>`. –ü—Ä–∏—à–ª–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –∏ –≤—ã–≤–æ–¥.

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –í Terraform >= 1.6 –ø–æ—è–≤–∏–ª—Å—è –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ —á–µ—Ä–µ–∑ `use_lockfile = true`. 
–≠—Ç–æ —É–ø—Ä–æ—â–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫—É - –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö (YDB –≤ —Ä–µ–∂–∏–º–µ DynamoDB) –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫.
Lock-—Ñ–∞–π–ª —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ —Ç–æ–º –∂–µ S3 bucket —Ä—è–¥–æ–º —Å state-—Ñ–∞–π–ª–æ–º —Å –∏–º–µ–Ω–µ–º `<key>.lock.info`.


------


2.2
# 1. –°–æ–∑–¥–∞–µ–º S3 bucket
yc storage bucket create --name terraform-state-bucket-$(date +%s) --acl private\
  --name terraform-state-bucket-$(date +%s) \
  --default-storage-class standard \
  --max-size 1073741824 \
  --public-read-off \
  --public-list-off


# –ü—Ä–æ—Å—Ç–∞—è –∫–æ–º–∞–Ω–¥–∞ - —Ç–æ–ª—å–∫–æ –∏–º—è bucket
yc storage bucket create --name terraform-state-bucket-$(date +%s)
–ò–ª–∏ –ø–æ —à–∞–≥–∞–º:

bash
# 1. –°–æ–∑–¥–∞–µ–º bucket —Å –ø—Ä–æ—Å—Ç–æ–π –∫–æ–º–∞–Ω–¥–æ–π
yc storage bucket create --name terraform-state-bucket-1732534567

# 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Å–æ–∑–¥–∞–ª—Å—è
yc storage bucket list

# 3. –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
yc storage bucket update --name terraform-state-bucket-1732534567 --acl private


2. –°–æ–∑–¥–∞–µ–º Service Account

# –°–æ–∑–¥–∞–µ–º service account
yc iam service-account create --name terraform-sa
Service account 'ajeo1******8r9'

# –ü–æ–ª—É—á–∞–µ–º ID service account
SA_ID=$(yc iam service-account get terraform-sa --format json | jq -r '.id')
echo "Service Account ID: $SA_ID"

# –ù–∞–∑–Ω–∞—á–∞–µ–º –ø—Ä–∞–≤–∞ –Ω–∞ storage
yc resource-manager folder add-access-binding b1gokds3ue11292eobjh \
  --role storage.editor \
  --subject serviceAccount:ajeo*******to8r9

  --role storage.editor \
>   --subject serviceAccount:ajeo1o2q*****r9done 
effective_deltas:
  - action: ADD
    access_binding:
      role_id: storage.editor
      subject:
        id: ajeo1o2q593dki4to8r9
        type: serviceAccount


# –°–æ–∑–¥–∞–µ–º —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –∫–ª—é—á–∏ –¥–æ—Å—Ç—É–ø–∞
yc iam access-key create --service-account-name terraform-sa --format json
{
  "access_key": {
    "id": "aje**********lj1s05q",
    "service_account_id": "aje*********4to8r9",
    "created_at": "2025-11-25T03:56:04.282361495Z",
    "key_id": "YCAJE*******M0qmEe"
  },
  "secret": "YCMvhV********xrTWU"
}


3. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º environment variables

# –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º –∫–ª—é—á–∏ –¥–æ—Å—Ç—É–ø–∞ (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–∞—à–∏ –∫–ª—é—á–∏ –∏–∑ –≤—ã–≤–æ–¥–∞)
export AWS_ACCESS_KEY_ID="YCA*******8M0qmEe"
export AWS_SECRET_ACCESS_KEY="YCM*********yxrTWU"


4. –û–±–Ω–æ–≤–ª—è–µ–º providers.tf
bash
# –°–æ–∑–¥–∞–µ–º providers.tf —Å –≤–∞—à–∏–º –∏–º–µ–Ω–µ–º bucket
# –û–±–Ω–æ–≤–ª—è–µ–º providers.tf –±–µ–∑ use_lockfile
cat > providers.tf << 'EOF'
terraform {
  required_version = "~>1.9.0"
  required_providers {
    yandex = {
      source = "yandex-cloud/yandex"
    }
  }

  backend "s3" {
    bucket  = "terraform-state-bucket-1764042687"
    key     = "terraform.tfstate"
    region  = "ru-central1"
    
    endpoints = {
      s3 = "https://storage.yandexcloud.net"
    }
    
    skip_region_validation      = true
    skip_credentials_validation = true
    skip_requesting_account_id  = true
    skip_s3_checksum            = true
  }
}

provider "yandex" {
  token     = var.token
  cloud_id  = var.cloud_id
  folder_id = var.folder_id
  zone      = var.default_zone
}
EOF


5. –ú–∏–≥—Ä–∏—Ä—É–µ–º state
# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏ –º–∏–≥—Ä–∏—Ä—É–µ–º state
terraform init -migrate-state

# –ö–æ–≥–¥–∞ —Å–ø—Ä–æ—Å–∏—Ç: "Do you want to copy existing state to the new backend?"
# –í–≤–µ–¥–∏—Ç–µ "yes"


export TF_VAR_token="t1*******.9euelZqzMz57IMOmg6dAw"

yc iam create-token
sudo apt update
sudo apt install awscli -y

–ó–∞—Ç–µ–º –Ω–∞—Å—Ç—Ä–æ–∏–º awscli –¥–ª—è Yandex Cloud:

bash
aws configure set aws_access_key_id $AWS_ACCESS_KEY_ID
aws configure set aws_secret_access_key $AWS_SECRET_ACCESS_KEY
aws configure set default.region ru-central1

1. –ò—Å–ø—Ä–∞–≤–∏–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π HashiCorp
# –£–¥–∞–ª–∏–º –ø—Ä–æ–±–ª–µ–º–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π HashiCorp
sudo rm -f /etc/apt/sources.list.d/hashicorp.list

# –û–±–Ω–æ–≤–∏–º —Å–ø–∏—Å–æ–∫ –ø–∞–∫–µ—Ç–æ–≤ –±–µ–∑ HashiCorp
sudo apt update


2. –£—Å—Ç–∞–Ω–æ–≤–∏–º awscli —á–µ—Ä–µ–∑ pip3

# –£—Å—Ç–∞–Ω–æ–≤–∏–º pip3 –µ—Å–ª–∏ –Ω–µ—Ç
sudo apt install python3-pip -y

# –£—Å—Ç–∞–Ω–æ–≤–∏–º awscli —á–µ—Ä–µ–∑ pip3
pip3 install awscli --user

# –î–æ–±–∞–≤–∏–º –≤ PATH
echo 'export PATH="$HOME/.local/bin:$PATH"' >> ~/.bashrc
source ~/.bashrc

# –ü—Ä–æ–≤–µ—Ä–∏–º —É—Å—Ç–∞–Ω–æ–≤–∫—É
aws --version

3. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ - –∏—Å–ø–æ–ª—å–∑—É–µ–º yc –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ S3

# –ü—Ä–æ–≤–µ—Ä–∏–º bucket —á–µ—Ä–µ–∑ yc (–∏—Å–ø–æ–ª—å–∑—É–µ–º s3 –∫–æ–º–∞–Ω–¥—ã)
yc storage --help

# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º curl –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
curl -s -X GET "https://storage.yandexcloud.net/terraform-state-bucket-1764042687/" \
  -H "Authorization: Bearer $(yc iam create-token)"

4. –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ Terraform

# –°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ Terraform
terraform state list

# –ï—Å–ª–∏ state –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–∑ S3 - –∑–Ω–∞—á–∏—Ç –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç
terraform show


5. –ù–∞—Å—Ç—Ä–æ–∏–º awscli –¥–ª—è Yandex Cloud
bash
# –ù–∞—Å—Ç—Ä–æ–∏–º awscli –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Yandex Cloud S3
aws configure set aws_access_key_id $AWS_ACCESS_KEY_ID
aws configure set aws_secret_access_key $AWS_SECRET_ACCESS_KEY
aws configure set default.region ru-central1
aws configure set default.s3.endpoint_url https://storage.yandexcloud.net
aws configure set default.s3.signature_version s3v4

# –ü—Ä–æ–≤–µ—Ä–∏–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
aws s3 ls s3://terraform-state-bucket-1764042687/ --endpoint-url https://storage.yandexcloud.net


–ù–æ —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä–∏–º, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ª–∏ environment variables:
echo $AWS_ACCESS_KEY_ID
echo $AWS_SECRET_ACCESS_KEY


–°–æ–∑–¥–∞–¥–∏–º –ø—Ä–æ—Ñ–∏–ª—å AWS:

aws configure set aws_access_key_id $AWS_ACCESS_KEY_ID
aws configure set aws_secret_access_key $AWS_SECRET_ACCESS_KEY
aws configure set default.region ru-central1

 —É—Å—Ç–∞–Ω–æ–≤–∏–º awscli —á–µ—Ä–µ–∑ pip3 –∏ –ø—Ä–æ–≤–µ—Ä–∏–º –¥–æ—Å—Ç—É–ø.

pip3 install awscli --user
export PATH="$HOME/.local/bin:$PATH"
aws configure set aws_access_key_id $AWS_ACCESS_KEY_ID
aws configure set aws_secret_access_key $AWS_SECRET_ACCESS_KEY
aws configure set default.region ru-central1
aws configure set default.s3.endpoint_url https://storage.yandexcloud.net
aws configure set default.s3.signature_version s3v4
aws s3 ls s3://terraform-state-bucket-1764042687/



—Å–æ–∑–¥–∞–¥–∏–º –Ω–æ–≤—ã–µ –∫–ª—é—á–∏:
yc iam access-key create --service-account-name terraform-sa --format json


–ó–∞—Ç–µ–º —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

bash
export AWS_ACCESS_KEY_ID=<access_key_id>
export AWS_SECRET_ACCESS_KEY=<secret_key>

1. –ü—Ä–æ–≤–µ—Ä–∏–º —Ç–µ–∫—É—â–∏–µ environment variables
echo "AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID"
echo "AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY"

2. –£—Å—Ç–∞–Ω–æ–≤–∏–º –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
bash
# –£—Å—Ç–∞–Ω–æ–≤–∏–º access key –∏ secret key (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–∞—à–∏ –∑–Ω–∞—á–µ–Ω–∏—è)
export AWS_ACCESS_KEY_ID="YCA*********e"
export AWS_SECRET_ACCESS_KEY="YCMvhV*******
# –¢–∞–∫–∂–µ —É—Å—Ç–∞–Ω–æ–≤–∏–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
export TF_VAR_token="t1.9euel********8zMz57IyylvMOmg6dAw"
export TF_VAR_cloud_id="b*****6b87"
export TF_VAR_folder_id="b1g******2eobjh"


terraform init
terraform validate
terraform plan
terraform apply -auto-approve
 terraform apply
 terraform show

–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫
–¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏
–¢–µ—Ä–º–∏–Ω–∞–ª 1:

bash
# –ó–∞–ø—É—Å–∫–∞–µ–º apply (—Å–æ–∑–¥–∞—Å—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫—É)
terraform apply
–¢–µ—Ä–º–∏–Ω–∞–ª 2 (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ):

bash
# –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–ø—É—Å—Ç–∏—Ç—å apply –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
terraform apply
–¢–µ—Å—Ç 2: –°–æ–∑–¥–∞–¥–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
–î–æ–±–∞–≤–∏–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ä–µ—Å—É—Ä—Å –≤ main.tf:

hcl
# –í—Ä–µ–º–µ–Ω–Ω—ã–π —Ä–µ—Å—É—Ä—Å –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫
resource "yandex_vpc_network" "test_lock" {
  name = "test-lock-network-${random_id.test.hex}"
}

resource "random_id" "test" {
  byte_length = 4
}
–¢–µ—Å—Ç 3: –ó–∞–ø—É—Å—Ç–∏–º –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
–¢–µ—Ä–º–∏–Ω–∞–ª 1:

terraform apply -auto-approve
–¢–µ—Ä–º–∏–Ω–∞–ª 2 (—Å—Ä–∞–∑—É –ø–æ—Å–ª–µ):

terraform apply -auto-approve
–§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
bash
# –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ state –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
terraform state list

# –ü—Ä–æ–≤–µ—Ä–∏–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ bucket –ø–æ—Å–ª–µ –æ–ø–µ—Ä–∞—Ü–∏–π
aws s3 ls s3://terraform-state-bucket-1764042687/ --endpoint-url https://storage.yandexcloud.net
–û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
bash
# –£–¥–∞–ª–∏–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã
terraform destroy -target=yandex_vpc_network.test_lock -auto-approve

# –£–¥–∞–ª–∏–º random_id –∏–∑ state
terraform state rm random_id.test
–ò—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
‚úÖ S3 bucket —Å–æ–∑–¥–∞–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
‚úÖ State —É—Å–ø–µ—à–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ terraform-state-bucket-1764042687
‚úÖ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—é—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
‚úÖ –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ remote state

–í–∞—à Terraform —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–∞–¥–µ–∂–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ state —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º–∏! üéâ

–î–ª—è –ø–æ–ª–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ:

–°–∫—Ä–∏–Ω—à–æ—Ç —Å–æ–∑–¥–∞–Ω–∏—è bucket

–°–∫—Ä–∏–Ω—à–æ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ state (terraform init -migrate-state)

–°–∫—Ä–∏–Ω—à–æ—Ç –æ—à–∏–±–∫–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–º –∑–∞–ø—É—Å–∫–µ

–°–∫—Ä–∏–Ω—à–æ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ S3 bucket —Å state —Ñ–∞–π–ª–æ–º

1. –û—á–∏—Å—Ç–∏–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
bash
# –£–¥–∞–ª–∏–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ä–µ—Å—É—Ä—Å –∏–∑ main.tf
sed -i '/resource "yandex_vpc_network" "test_lock"/,/^}/d' main.tf

# –£–¥–∞–ª–∏–º —Å–∫—Ä–∏–ø—Ç
rm -f test_lock.sh


–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:

‚úÖ State —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ S3 bucket

‚úÖ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—é—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã

‚úÖ –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞–¥–µ–∂–Ω–æ

‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ production



1. –ü—Ä–æ–≤–µ—Ä–∏–º —Ç–µ–∫—É—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
bash
echo "AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID"
echo "AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY"
2. –ü—Ä–∞–≤–∏–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏–º AWS_ACCESS_KEY_ID
bash
# –ü—Ä–∞–≤–∏–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏–º AWS_ACCESS_KEY_ID (–±–µ–∑ –ø–µ—Ä–µ–Ω–æ—Å–∞ —Å—Ç—Ä–æ–∫–∏)
export AWS_ACCESS_KEY_ID="YCAJEhLkJmQDZTlb9N8M0qmEe"
3. –ü—Ä–æ–≤–µ—Ä–∏–º —á—Ç–æ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
bash
echo "AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID"
echo "AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY"
echo "TF_VAR_token: $TF_VAR_token"
echo "TF_VAR_cloud_id: $TF_VAR_cloud_id" 
echo "TF_VAR_folder_id: $TF_VAR_folder_id"



–°–∫–∞—á–∞–µ–º –ø—Ä–æ–≤–∞–π–¥–µ—Ä 
# –ü–µ—Ä–µ–π–¥–µ–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
cd ~/.terraform.d/plugins/registry.terraform.io/yandex-cloud/yandex/0.172.0/linux_amd64

# –°–∫–∞—á–∞–µ–º –ø—Ä–æ–≤–∞–π–¥–µ—Ä —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ URL
wget -O terraform-provider-yandex_0.172.0_linux_amd64.zip https://github.com/yandex-cloud/terraform-provider-yandex/releases/download/v0.172.0/terraform-provider-yandex_0.172.0_linux_amd64.zip

# –†–∞—Å–ø–∞–∫—É–µ–º
unzip terraform-provider-yandex_0.172.0_linux_amd64.zip

# –£–±–µ–¥–∏–º—Å—è —á—Ç–æ —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
ls -la

# –î–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ñ–∞–π–ª: terraform-provider-yandex_v0.172.0

























### –ó–∞–¥–∞–Ω–∏–µ 3  

1. –°–¥–µ–ª–∞–π—Ç–µ –≤ GitHub –∏–∑ –≤–µ—Ç–∫–∏ 'terraform-05' –Ω–æ–≤—É—é –≤–µ—Ç–∫—É 'terraform-hotfix'.
2. –ü—Ä–æ–≤–µ—Ä—å–µ –∫–æ–¥ —Å –ø–æ–º–æ—â—å—é tflint –∏ checkov, –∏—Å–ø—Ä–∞–≤—å—Ç–µ –≤—Å–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –∏ –æ—à–∏–±–∫–∏ –≤ 'terraform-hotfix', —Å–¥–µ–ª–∞–π—Ç–µ –∫–æ–º–º–∏—Ç.
3. –û—Ç–∫—Ä–æ–π—Ç–µ –Ω–æ–≤—ã–π pull request 'terraform-hotfix' --> 'terraform-05'. 
4. –í—Å—Ç–∞–≤—å—Ç–µ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π PR —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞ tflint –∏ checkov, –ø–ª–∞–Ω –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏–∑ –≤—ã–≤–æ–¥–∞ –∫–æ–º–∞–Ω–¥—ã terraform plan.
5. –ü—Ä–∏—à–ª–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ PR –¥–ª—è —Ä–µ–≤—å—é. –í–ª–∏–≤–∞—Ç—å –∫–æ–¥ –≤ 'terraform-05' –Ω–µ –Ω—É–∂–Ω–æ.

------

# –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
 git clone https://github.com/sapr797/ter-homeworks.git 
 cd ter-homeworks

1. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –Ω–∞ –≤–µ—Ç–∫—É terraform-05
git checkout terraform-05

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ –≤–µ—Ç–∫–∏ terraform-05 –≤ —É–¥–∞–ª–µ–Ω–Ω–æ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏:
git branch -r | grep terraform-05

3.  –ï—Å–ª–∏ –≤–µ—Ç–∫–∏ terraform-05 –Ω–µ—Ç, —Ç–æ —Å–æ–∑–¥–∞–π—Ç–µ –µ–µ –∏–∑ –≤–µ—Ç–∫–∏ main :

git checkout main
git checkout -b terraform-05
git push origin terraform-05

 4.—Å–æ–∑–¥–∞–π—Ç–µ terraform-hotfix:
 git checkout -b terraform-hotfix

5.–û—Ç–ø—Ä–∞–≤—å—Ç–µ –Ω–æ–≤—É—é –≤–µ—Ç–∫—É terraform-hotfix –≤ —É–¥–∞–ª–µ–Ω–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
git push origin terraform-hotfix


3.–ï—Å–ª–∏ –≤–µ—Ç–∫–∞ –µ—Å—Ç—å, –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –Ω–∞ –Ω–µ–µ –∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é –≤–µ—Ç–∫—É:
git checkout terraform-05
git checkout -b terraform-hotfix

–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–≤jq –≤–µ—Ç–∫–∏
https://github.com/sapr797/ter-homeworks/tree/terraform-hotfix

# –ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–æ—Ä–µ–Ω—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
cd ~/terraform-project/ter-homeworks

# –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
git fetch origin

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –≤–µ—Ç–∫–∏ terraform-hotfix –≤ —É–¥–∞–ª–µ–Ω–Ω–æ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
git branch -r | grep hotfix

# –ï—Å–ª–∏ –µ—Å—Ç—å origin/terraform-hotfix, —Ç–æ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –Ω–µ–µ 
git checkout -b terraform-hotfix origin/terraform-hotfix

cd ~/terraform-project/ter-homeworks/terraform-hotfix


–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
–°–Ω–∞—á–∞–ª–∞ –ø–æ—Å–º–æ—Ç—Ä–∏–º, –∫–∞–∫–∏–µ –≤–µ—Ç–∫–∏ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏:

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –≤–µ—Ç–∫–∏ (–ª–æ–∫–∞–ª—å–Ω—ã–µ –∏ —É–¥–∞–ª–µ–Ω–Ω—ã–µ)
git branch -a

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω—ã–µ –≤–µ—Ç–∫–∏
git branch

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç—É—Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
git status

# –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –≤–µ—Ç–∫—É terraform-05
git checkout terraform-05

–ü–µ—Ä–µ–π–¥–µ–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é 04/src –∏ –∑–∞–ø—É—Å—Ç–∏–º tflint –∏ checkov: 
cd ~/terraform-project/ter-homeworks/04/src

–∑–∞–ø—É—Å—Ç–∏–º tflint –∏ –∏—Å–ø—Ä–∞–≤–∏–º –æ—à–∏–±–∫–∏

–∑–∞—Ç–µ–º checkov –∏ –∏—Å–ø—Ä–∞–≤–∏–º –æ—à–∏–±–∫–∏, 

–∑–∞—Ç–µ–º –∫–æ–º–º–∏—Ç

TFLint —Å–æ–æ–±—â–∞–µ—Ç –æ 6 –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è—Ö, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏.
–í—Å–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ—Ç–Ω–æ—Å—è—Ç—Å—è –∫ –ø—Ä–∞–≤–∏–ª—É terraform_unused_declarations, —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–±—ä—è–≤–ª–µ–Ω—ã, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –∫–æ–¥–µ.

–°–≥—Ä—É–ø–ø–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏:

–ì—Ä—É–ø–ø–∞ 1: –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –¥–æ—Å—Ç—É–ø–∞ (3 –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ)
variable "token" (—Å—Ç—Ä–æ–∫–∞ 2)
variable "cloud_id" (—Å—Ç—Ä–æ–∫–∞ 7)
variable "folder_id" (—Å—Ç—Ä–æ–∫–∞ 12)

–ì—Ä—É–ø–ø–∞ 2: –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è SSH –∫–ª—é—á–∞ (1 –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è)
variable "vms_ssh_root_key" (—Å—Ç—Ä–æ–∫–∞ 36)

–ì—Ä—É–ø–ø–∞ 3: –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–º–µ–Ω –í–ú (2 –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ)
variable "vm_web_name" (—Å—Ç—Ä–æ–∫–∞ 43)
variable "vm_db_name" (—Å—Ç—Ä–æ–∫–∞ 50)

–í—Å–µ —ç—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–±—ä—è–≤–ª–µ–Ω—ã –≤ —Ñ–∞–π–ª–µ variables.tf, –Ω–æ –Ω–∏–≥–¥–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ main.tf –∏–ª–∏ –¥—Ä—É–≥–∏—Ö —Ñ–∞–π–ª–∞—Ö).

–†–µ—à–µ–Ω–∏–µ:
–ü–æ—Å–∫–æ–ª—å–∫—É —ç—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è, –∏—Ö —Å–ª–µ–¥—É–µ—Ç —É–¥–∞–ª–∏—Ç—å –∏–∑ variables.tf, —á—Ç–æ–±—ã –æ—á–∏—Å—Ç–∏—Ç—å –∫–æ–¥.

–ü–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –±–æ–ª—å—à–µ –Ω–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π, –∑–∞–ø—É—Å—Ç–∏–≤ tflint —Å–Ω–æ–≤–∞.

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Å –∫–æ–¥–æ–º
cd ~/terraform-project/ter-homeworks/04/src

# –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª—é–±–æ–π —Ä–µ–¥–∞–∫—Ç–æ—Ä, –Ω–∞–ø—Ä–∏–º–µ—Ä, nano
nano variables.tf


–í —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ —É–¥–∞–ª—è–µ–º –±–ª–æ–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö:

variable "token" { ... }
variable "cloud_id" { ... }
variable "folder_id" { ... }
variable "vms_ssh_root_key" { ... }
variable "vm_web_name" { ... }
variable "vm_db_name" { ... }


–¢–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä–∏–º —Å –ø–æ–º–æ—â—å—é checkov:
checkov -d .
checkov -d . --skip-download
checkov -d . --skip-download -o cli

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π, –∫–æ–º–º–∏—Ç–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è:

git add variables.tf
git commit -m "–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π TFLint: —É–¥–∞–ª–µ–Ω—ã –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ"
git push origin terraform-hotfix


–î–∞–≤–∞–π—Ç–µ –ø–æ–ø—Ä–æ–±—É–µ–º –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –≤—ã–≤–æ–¥ –≤ —Ñ–∞–π–ª:
checkov -d . > checkov_results.txt 2>&1

–ï—Å–ª–∏ –≤—ã–≤–æ–¥ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π, –º–æ–∂–Ω–æ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ FAILED:
checkov -d . --skip-download | grep -A 5 -B 5 "FAILED"

1. –°–Ω–∞—á–∞–ª–∞ –ø–æ—Å–º–æ—Ç—Ä–∏–º –ø–æ–ª–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã Checkov
# –ó–∞–ø—É—Å—Ç–∏–º Checkov –∏ —Å–æ—Ö—Ä–∞–Ω–∏–º –ø–æ–ª–Ω—ã–π –≤—ã–≤–æ–¥
checkov -d . --skip-download > checkov_full_results.txt

# –ü—Ä–æ—Å–º–æ—Ç—Ä–∏–º –≤–µ—Å—å —Ñ–∞–π–ª —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
cat checkov_full_results.txt


2. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
# –ó–∞–ø—É—Å—Ç–∏–º Checkov –∏ –æ—Ç—Ñ–∏–ª—å—Ç—Ä—É–µ–º FAILED –ø—Ä–æ–≤–µ—Ä–∫–∏
checkov -d . --skip-download | grep -E "(FAILED|PASSED|SKIPPED)" | head -20

# –ò–ª–∏ –ø–æ—Å–º–æ—Ç—Ä–∏–º —Å–≤–æ–¥–∫—É
checkov -d . --skip-download --compact

5. –ü—Ä–æ–≤–µ—Ä–∏–º —Å–∏–Ω—Ç–∞–∫—Å–∏—Å Terraform
terraform validate

6. –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π —Å–¥–µ–ª–∞–µ–º –∫–æ–º–º–∏—Ç
# –î–æ–±–∞–≤–∏–º –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
git add .

# –°–æ–∑–¥–∞–¥–∏–º –∫–æ–º–º–∏—Ç
git commit -m "Fix code quality issues

# –û—Ç–ø—Ä–∞–≤–∏–º –≤ –≤–µ—Ç–∫—É terraform-hotfix
git push origin terraform-hotfix

7. –ü—Ä–æ–≤–µ—Ä–∏–º —Å—Ç–∞—Ç—É—Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
git status
git log --oneline -3

1. –ü–æ—Å–º–æ—Ç—Ä–∏–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
# –ü–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ –æ–±–∞ —Ñ–∞–π–ª–∞ —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
cat providers.tf
cat provider-auth.tf


7. –ü—Ä–æ–≤–µ—Ä–∏–º —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å

terraform init
terraform init -reconfigure
terraform validate
tflint

8. –°–¥–µ–ª–∞–µ–º –∫–æ–º–º–∏—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
git add .
git commit -m "Fix Terraform configuration and authentication

- Clean up variables.tf structure
- Fix Terraform validation
- Prepare for Yandex Cloud authentication"

git push origin terraform-hotfix

–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –±—ç–∫–µ–Ω–¥–æ–º
–í–∞—Ä–∏–∞–Ω—Ç 1: –ü–µ—Ä–µ–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞—Ç—å –±—ç–∫–µ–Ω–¥ (hotfix)
terraform init -reconfigure
–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –±—ç–∫–µ–Ω–¥ —Å —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π –±–µ–∑ –ø–æ–ø—ã—Ç–∫–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è.

–í–∞—Ä–∏–∞–Ω—Ç 2: –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–Ω—É–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)
terraform init -migrate-state

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä–∏–º:

terraform validate
tflint

–ó–∞–ø—É—Å—Ç–∏–º –ø—Ä–æ–≤–µ—Ä–∫—É –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
checkov -d . --skip-download


–°–¥–µ–ª–∞–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –∫–æ–º–º–∏—Ç:

git add .
git commit -m "Complete hotfix: fix all warnings and errors

- Fix TFLint warnings by removing unused variables
- Fix Terraform provider configuration
- Resolve backend configuration issues
- All validations passing"

git push origin terraform-hotfix
–ü—Ä–æ–≤–µ—Ä–∏–º —Å—Ç–∞—Ç—É—Å –≤–µ—Ç–∫–∏:

git log --oneline -5
git status


# –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –≤–µ—Ç–∫—É terraform-hotfix
git checkout terraform-hotfix

# –ü–µ—Ä–µ–Ω–æ—Å–∏–º –∫–æ–º–º–∏—Ç –∏–∑ terraform-05 –≤ terraform-hotfix
git merge terraform-05

# –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —É–¥–∞–ª–µ–Ω–Ω—É—é –≤–µ—Ç–∫—É terraform-hotfix
git push origin terraform-hotfix


# –û–±–Ω–æ–≤–ª—è–µ–º –≤–µ—Ç–∫—É
git pull origin terraform-hotfix

# –í—ã–ø–æ–ª–Ω—è–µ–º terraform plan –¥–ª—è –ø–æ–∫–∞–∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π
terraform plan


# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å –ª–æ–∫–∞–ª—å–Ω—ã–º –±—ç–∫–µ–Ω–¥–æ–º
terraform init

# –í—ã–ø–æ–ª–Ω—è–µ–º terraform plan –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–≤–æ–¥
terraform plan -out=tfplan
terraform show tfplan > terraform_plan_output.txt

# –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π providers.tf
mv providers.tf.backup providers.tf

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –æ–±—Ä–∞—Ç–Ω–æ —Å S3 –±—ç–∫–µ–Ω–¥–æ–º (–ø—Ä–æ–ø—É—Å—Ç–∏–º –µ—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è)
terraform init -reconfigure || true


# –£–¥–∞–ª—è–µ–º –≤—Å–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã Terraform
rm -rf .terraform
rm -f .terraform.lock.hcl
rm -f terraform.tfstate*
rm -f tfplan

# –¢–µ–ø–µ—Ä—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å —á–∏—Å—Ç–æ–≥–æ –ª–∏—Å—Ç–∞
terraform init

# –í—ã–ø–æ–ª–Ω—è–µ–º terraform plan

terraform plan -out=tfplan

# –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–≤–æ–¥ –ø–ª–∞–Ω–∞
terraform show tfplan > terraform_plan_output.txt

# –ü—Ä–æ—Å–º–æ—Ç—Ä–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
cat terraform_plan_output.txt


cd ~/terraform-project/ter-homeworks/04/src


–õ–æ–∫–∞–ª—å–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –≤–µ—Ç–∫—É terraform-05 –∏ —É–¥–∞–ª—è–µ–º –≤–µ—Ç–∫—É terraform-hotfix:

git checkout terraform-05
git branch -D terraform-hotfix


–°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –≤–µ—Ç–∫—É terraform-hotfix –∏–∑ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–π terraform-05:

git checkout -b terraform-hotfix



# –î–æ–±–∞–≤—å—Ç–µ –ø—Ä–∞–≤–∏–ª–æ –≤ .gitignore –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–æ–¥–æ–±–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π
echo "*.pem" >> .gitignore
echo "*.key" >> .gitignore  
echo "*.pub" >> .gitignore
echo "ssh*" >> .gitignore
echo "id_*" >> .gitignore

git add .gitignore
git commit -m "Add .gitignore rules for SSH keys"
git push origin terraform-hotfix



 https://github.com/sapr797/ter-homeworks/pull/new/terraform-hotfix-
 
 https://github.com/sapr797/ter-homeworks/compare/main...terraform-hotfix-final?expand=1


https://github.com/sapr797/ter-homeworks/pull/2


—É–±–µ–¥–∏–º—Å—è, —á—Ç–æ —É –Ω–∞—Å –µ—Å—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è:
git fetch origin

–ø–µ—Ä–µ–∫–ª—é—á–∏–º—Å—è –Ω–∞ –≤–µ—Ç–∫—É terraform-hotfix-final:
git checkout terraform-hotfix-final

–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å SSH
1. –ü—Ä–æ–≤–µ—Ä–∏–º —Ç–µ–∫—É—â–∏–π remote URL
git remote -v
2. –í—Ä–µ–º–µ–Ω–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∏–º—Å—è –Ω–∞ HTTPS
# –ò–∑–º–µ–Ω–∏–º remote –Ω–∞ HTTPS
git remote set-url origin https://github.com/sapr797/ter-homeworks.git

# –ü—Ä–æ–≤–µ—Ä–∏–º —á—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å
git remote -v
3. –¢–µ–ø–µ—Ä—å –ø–µ—Ä–µ–∫–ª—é—á–∏–º—Å—è –Ω–∞ –≤–µ—Ç–∫—É terraform-hotfix-final

# –ü–æ–ª—É—á–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–µ—Ç–∫–∞—Ö
git fetch origin

# –ü–µ—Ä–µ–∫–ª—é—á–∏–º—Å—è –Ω–∞ –≤–µ—Ç–∫—É terraform-hotfix-final
git checkout terraform-hotfix-final

# –ò–ª–∏ –µ—Å–ª–∏ –≤–µ—Ç–∫–∏ –Ω–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ
git checkout -b terraform-hotfix-final origin/terraform-hotfix-final

4. –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –ø—Ä–æ–±–ª–µ–º—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä—è–º–æ–π –ø–æ–¥—Ö–æ–¥
# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∏–º—Å—è, –∏–≥–Ω–æ—Ä–∏—Ä—É—è –≤–æ–∑–º–æ–∂–Ω—ã–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã
git checkout -f terraform-hotfix-final

# –ò–ª–∏ —Å–æ–∑–¥–∞–¥–∏–º –Ω–æ–≤—É—é –ª–æ–∫–∞–ª—å–Ω—É—é –≤–µ—Ç–∫—É –∏–∑ —Ç–æ–≥–æ —á—Ç–æ –µ—Å—Ç—å
git checkout -b temp-branch

# –ó–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω–∏–º fetch –∏ checkout
git fetch origin
git checkout terraform-hotfix-final

üîÑ –°–æ–∑–¥–∞–¥–∏–º —á–∏—Å—Ç—É—é –∫–æ–ø–∏—é
# –í–µ—Ä–Ω–µ–º—Å—è –≤ –¥–æ–º–∞—à–Ω—é—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
cd ~

# –°–∫–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∑–∞–Ω–æ–≤–æ —á–µ—Ä–µ–∑ HTTPS
git clone https://github.com/sapr797/ter-homeworks.git ter-homeworks-new
cd ter-homeworks-new

# –ü–µ—Ä–µ–∫–ª—é—á–∏–º—Å—è –Ω–∞ –Ω—É–∂–Ω—É—é –≤–µ—Ç–∫—É
git checkout terraform-hotfix-final

# –ü—Ä–æ–≤–µ—Ä–∏–º —Ç–µ–∫—É—â—É—é –≤–µ—Ç–∫—É
git branch

# –ü–æ—Å–º–æ—Ç—Ä–∏–º —Ñ–∞–π–ª—ã
ls -la

# –ü—Ä–æ–≤–µ—Ä–∏–º —á—Ç–æ –º—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
pwd
–í—ã–ø–æ–ª–Ω–∏—Ç–µ —ç—Ç–∏ –∫–æ–º–∞–Ω–¥—ã –ø–æ –ø–æ—Ä—è–¥–∫—É:
cd ~/terraform-project/ter-homeworks
git remote set-url origin https://github.com/sapr797/ter-homeworks.git
git fetch origin
git checkout terraform-hotfix-final


=======================================










### –ó–∞–¥–∞–Ω–∏–µ 4

1. –ù–∞–ø–∏—à–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∏—Ö, –∑–∞–ø–æ–ª–Ω–∏–≤ default –≤–µ—Ä–Ω—ã–º–∏ –∏ –Ω–µ–≤–µ—Ä–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –ø—Ä–æ–≤–µ—Ä–æ–∫ –∏–∑ terraform console. 

- type=string, description="ip-–∞–¥—Ä–µ—Å" ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π —Å–æ–¥–µ—Ä–∂–∏—Ç –≤–µ—Ä–Ω—ã–π IP-–∞–¥—Ä–µ—Å —Å –ø–æ–º–æ—â—å—é —Ñ—É–Ω–∫—Ü–∏–π cidrhost() –∏–ª–∏ regex(). –¢–µ—Å—Ç—ã:  "192.168.0.1" –∏ "1920.1680.0.1";
- type=list(string), description="—Å–ø–∏—Å–æ–∫ ip-–∞–¥—Ä–µ—Å–æ–≤" ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –≤—Å–µ –∞–¥—Ä–µ—Å–∞ –≤–µ—Ä–Ω—ã. –¢–µ—Å—Ç—ã:  ["192.168.0.1", "1.1.1.1", "127.0.0.1"] –∏ ["192.168.0.1", "1.1.1.1", "1270.0.0.1"].


-----------------------------------

cd ~/ter-homeworks-new/04/src

–í–∞–ª–∏–¥–Ω—ã–π IP "192.168.0.1" - —Ñ—É–Ω–∫—Ü–∏—è regex –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç, —É—Å–ø–µ—à–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å —à–∞–±–ª–æ–Ω–æ–º

–ù–µ–≤–∞–ª–∏–¥–Ω—ã–π IP "1920.1680.0.1" - regex –≤—ã–¥–∞–µ—Ç –æ—à–∏–±–∫—É, —Ç–∞–∫ –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —à–∞–±–ª–æ–Ω—É IP-–∞–¥—Ä–µ—Å–∞

–í–∞–ª–∏–¥–Ω—ã–π —Å–ø–∏—Å–æ–∫ IP - –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —É—Å–ø–µ—à–Ω–æ
–ù–µ–≤–∞–ª–∏–¥–Ω—ã–π —Å–ø–∏—Å–æ–∫ IP - –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ "1270.0.0.1"

–ü—Ä–æ–±–ª–µ–º–∞ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π default –∑–Ω–∞—á–µ–Ω–∏–π
–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ default –Ω–∞ "1920.1680.0.1" Terraform –Ω–µ —É–≤–∏–¥–µ–ª –æ—à–∏–±–∫—É. –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ terraform validate –¥–ª—è default –∑–Ω–∞—á–µ–Ω–∏–π.
–†–µ—à–µ–Ω–∏–µ: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–µ–º –≤–∞–ª–∏–¥–∞—Ü–∏—é —á–µ—Ä–µ–∑ terraform plan –∏–ª–∏ —Å–æ–∑–¥–∞–¥–∏–º terraform.tfvars

1. –°–æ–∑–¥–∞–¥–∏–º terraform.tfvars –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏

cd ~/ter-homeworks-new/validation_test
nano test_invalid_ip.tfvars
–î–æ–±–∞–≤—å—Ç–µ:


ip_address = "1920.1680.0.1"
ip_list = ["192.168.0.1", "1.1.1.1", "1270.0.0.1"]
2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–µ–º –≤–∞–ª–∏–¥–∞—Ü–∏—é —Å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏

# –¢–µ—Å—Ç —Å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –∏–∑ tfvars
terraform validate -var-file=test_invalid_ip.tfvars

# –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏!
3. –¢–µ—Å—Ç —Å –≤–∞–ª–∏–¥–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏

nano test_valid_ip.tfvars
–î–æ–±–∞–≤—å—Ç–µ:


ip_address = "192.168.0.1"
ip_list = ["192.168.0.1", "1.1.1.1", "127.0.0.1"]

terraform validate -var-file=test_valid_ip.tfvars
# –î–æ–ª–∂–µ–Ω –±—ã—Ç—å —É—Å–ø–µ—Ö!
4. –ü–µ—Ä–µ–Ω–µ—Å–µ–º –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤ –æ—Å–Ω–æ–≤–Ω–æ–π variables.tf

# –í–µ—Ä–Ω–µ–º—Å—è –≤ –æ—Å–Ω–æ–≤–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
cd ~/ter-homeworks-new/04/src

# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º variables.tf - –¥–æ–±–∞–≤–∏–º validation –±–ª–æ–∫–∏ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º
nano variables.tf
–î–æ–±–∞–≤—å—Ç–µ validation –±–ª–æ–∫–∏ –∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º.

5. –°–¥–µ–ª–∞–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –∫–æ–º–º–∏—Ç

cd ~/ter-homeworks-new

# –î–æ–±–∞–≤–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
git add .

# –°–¥–µ–ª–∞–µ–º –∫–æ–º–º–∏—Ç
git commit -m "Complete task 4: IP address validation with comprehensive testing

- Add regex validation for single IP addresses
- Add validation for IP address lists using alltrue() and regex
- Test both valid and invalid IPs in terraform console
- Demonstrate validation working with terraform.tfvars
- All validation rules working correctly"

git push origin terraform-hotfix-final


1. –£–¥–∞–ª–∏–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª validation_test.tf
# –£–¥–∞–ª–∏–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
rm ~/ter-homeworks-new/04/src/validation_test.tf

# –ü—Ä–æ–≤–µ—Ä–∏–º —á—Ç–æ —Ñ–∞–π–ª —É–¥–∞–ª–µ–Ω
ls -la ~/ter-homeworks-new/04/src/
2. –ü—Ä–æ–≤–µ—Ä–∏–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ variables.tf
cd ~/ter-homeworks-new/04/src
nano variables.tf
–£–±–µ–¥–∏–º—Å—è, —á—Ç–æ –≤ —Ñ–∞–π–ª–µ —Ç–æ–ª—å–∫–æ –û–î–ò–ù –±–ª–æ–∫ –¥–ª—è –∫–∞–∂–¥–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π:

#cloud vars
variable "default_zone" {
  type        = string
  default     = "ru-central1-a"
  description = "https://cloud.yandex.ru/docs/overview/concepts/geo-scope"
}

variable "default_cidr" {
  type        = list(string)
  default     = ["10.0.1.0/24"]
  description = "https://cloud.yandex.ru/docs/vpc/operations/subnet-create"
}

variable "vpc_name" {
  type        = string
  default     = "develop"
  description = "VPC network&subnet name"
}

# –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è –æ–¥–∏–Ω–æ—á–Ω–æ–≥–æ IP-–∞–¥—Ä–µ—Å–∞
variable "ip_address" {
  type        = string
  description = "ip-–∞–¥—Ä–µ—Å"
  default     = "192.168.0.1"

  validation {
    condition = can(regex("^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$", var.ip_address))
    error_message = "Invalid IP address format."
  }
}

# –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è —Å–ø–∏—Å–∫–∞ IP-–∞–¥—Ä–µ—Å–æ–≤
variable "ip_list" {
  type        = list(string)
  description = "—Å–ø–∏—Å–æ–∫ ip-–∞–¥—Ä–µ—Å–æ–≤"
  default     = ["192.168.0.1", "1.1.1.1", "127.0.0.1"]

  validation {
    condition = alltrue([
      for ip in var.ip_list : can(regex("^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$", ip))
    ])
    error_message = "One or more IP addresses in the list are invalid."
  }
}
3. –ü—Ä–æ–≤–µ—Ä–∏–º –≤–∞–ª–∏–¥–∞—Ü–∏—é

# –¢–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å
terraform validate
4. –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –µ—Å—Ç—å –æ—à–∏–±–∫–∏, –ø—Ä–æ–≤–µ—Ä–∏–º –≤—Å–µ —Ñ–∞–π–ª—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
bash# –ü–æ—Å–º–æ—Ç—Ä–∏–º –≤—Å–µ .tf —Ñ–∞–π–ª—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
find ~/ter-homeworks-new/04/src -name "*.tf" -type f

# –ï—Å–ª–∏ –µ—Å—Ç—å –¥—Ä—É–≥–∏–µ —Ñ–∞–π–ª—ã —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏, –ø—Ä–æ–≤–µ—Ä–∏–º –∏—Ö —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
grep -r "variable \"ip_address\"" ~/ter-homeworks-new/04/src/
grep -r "variable \"ip_list\"" ~/ter-homeworks-new/04/src/
5. –°–¥–µ–ª–∞–µ–º –∫–æ–º–º–∏—Ç

cd ~/ter-homeworks-new

# –î–æ–±–∞–≤–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
git add .

# –°–¥–µ–ª–∞–µ–º –∫–æ–º–º–∏—Ç
git commit -m "Complete task 4: Fix duplicate variables and add IP validation

- Remove duplicate validation_test.tf file
- Add IP address validation to variables.tf
- Fix variable declaration conflicts
- All validations working correctly"

git push origin terraform-hotfix-final


1. –ü—Ä–æ–≤–µ—Ä–∏–º, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ variables.tf
cd ~/ter-homeworks-new/04/src

# –ü—Ä–æ–≤–µ—Ä–∏–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ variables.tf
cat variables.tf | grep -A 15 "variable \"ip_address\""
cat variables.tf | grep -A 20 "variable \"ip_list\""

3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–µ–º –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤ —ç—Ç–æ–π –ø—Ä–æ—Å—Ç–æ–π —Å—Ä–µ–¥–µ
# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º
terraform init

# –ü—Ä–æ–≤–µ—Ä–∏–º –≤–∞–ª–∏–¥–∞—Ü–∏—é —Å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
terraform validate

# –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–µ–º —Å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ —á–µ—Ä–µ–∑ tfvars
nano invalid_test.tfvars
–î–æ–±–∞–≤–∏–º –≤ invalid_test.tfvars:

ip_address = "1920.1680.0.1"
ip_list = ["192.168.0.1", "1.1.1.1", "1270.0.0.1"]

# –ü—Ä–æ–≤–µ—Ä–∏–º –≤–∞–ª–∏–¥–∞—Ü–∏—é —Å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
terraform validate -var-file=invalid_test.tfvars


5. –°–¥–µ–ª–∞–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –∫–æ–º–º–∏—Ç
bash
cd ~/ter-homeworks-new

# –î–æ–±–∞–≤–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ variables.tf
git add 04/src/variables.tf

# –°–¥–µ–ª–∞–µ–º –∫–æ–º–º–∏—Ç
git commit -m "Complete task 4: Add IP address validation with comprehensive testing

- Add regex validation for ip_address variable
- Add validation for ip_list using alltrue() and regex
- Test both valid and invalid IP addresses
- Demonstrate validation working in isolated environment
- All requirements for task 4 completed"

git push origin terraform-hotfix-final


‚úÖ –°–æ–∑–¥–∞–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π:
ip_address —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ñ–æ—Ä–º–∞—Ç–∞ IP —á–µ—Ä–µ–∑ regex
ip_list —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å–ø–∏—Å–∫–∞

‚úÖ –ü—Ä–æ–≤–µ–¥–µ–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

–í–∞–ª–∏–¥–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è: "192.168.0.1", ["192.168.0.1", "1.1.1.1", "127.0.0.1"]
–ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è: "1920.1680.0.1", ["192.168.0.1", "1.1.1.1", "1270.0.0.1"]

‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ Terraform:
regex() –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–æ—Ä–º–∞—Ç–∞
can() –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
alltrue() –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–ø–∏—Å–∫–æ–≤


1. –ü–µ—Ä–µ–π–¥—ë–º –≤ –∫–æ—Ä–µ–Ω—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
cd ~/ter-homeworks-new

2. –î–æ–±–∞–≤—å—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ Git
# –î–æ–±–∞–≤–∏–º –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–π —Ñ–∞–π–ª variables.tf
git add 04/src/variables.tf

# –ü—Ä–æ–≤–µ—Ä–∏–º —Å—Ç–∞—Ç—É—Å
git status
3. –°–¥–µ–ª–∞–µ–º –∫–æ–º–º–∏—Ç

git commit -m "Complete task 4: Add IP address validation with comprehensive testing

- Add regex validation for ip_address variable
- Add validation for ip_list using alltrue() and regex
- Test both valid and invalid IP addresses
- Demonstrate validation working in isolated environment
- All requirements for task 4 completed"

4# –û—Ç–ø—Ä–∞–≤–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
git push origin terraform-hotfix-final
5# –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ SSH –∫–ª—é—á –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∞–≥–µ–Ω—Ç
eval "$(ssh-agent -s)"
ssh-add ~/.ssh/new_id_ed25519

 # –£–±–µ–¥–∏–º—Å—è  –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
pwd
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: /home/alexlinux/ter-homeworks-new

# –ü—Ä–æ–≤–µ—Ä–∏–º –≤–µ—Ç–∫—É
git branch

# –ü–æ—Å–º–æ—Ç—Ä–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
git diff


‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ:
‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ variables.tf –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ GitHub
‚úÖ –í–µ—Ç–∫–∞ terraform-hotfix-final –æ–±–Ω–æ–≤–ª–µ–Ω–∞
‚úÖ –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—è–≤–∏–ª–∏—Å—å –≤ PR #2

üìã –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:
PR #2 –æ–±–Ω–æ–≤–ª–µ–Ω: https://github.com/sapr797/ter-homeworks/pull/2

–î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è IP-–∞–¥—Ä–µ—Å–æ–≤ –≤ variables.tf
–í—Å–µ –∫–æ–º–º–∏—Ç—ã —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç

–ó–∞–¥–∞–Ω–∏–µ 4 –∑–∞–≤–µ—Ä—à–µ–Ω–æ:
–°–æ–∑–¥–∞–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π IP-–∞–¥—Ä–µ—Å–æ–≤

–ü—Ä–æ–≤–µ–¥–µ–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∞–ª–∏–¥–Ω—ã—Ö –∏ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ regex(), can(), alltrue()

üéØ –ü—Ä–æ–≤–µ—Ä–∏–ª PR #2 –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ:
https://github.com/sapr797/ter-homeworks/pull/2

2. –î–æ–±–∞–≤—å—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤ PR —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
–í –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ PR #2 –Ω–∞–ø–∏—à–∏—Ç–µ:

# –ó–∞–¥–∞–Ω–∏–µ 4 –≤—ã–ø–æ–ª–Ω–µ–Ω–æ ‚úÖ

### –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è IP-–∞–¥—Ä–µ—Å–æ–≤:

**–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π:**
- `ip_address` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ IP —á–µ—Ä–µ–∑ regex
- `ip_list` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å–ø–∏—Å–∫–∞ —á–µ—Ä–µ–∑ alltrue() –∏ regex

**–ü—Ä–æ–≤–µ–¥–µ–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –í–∞–ª–∏–¥–Ω—ã–µ IP: "192.168.0.1", ["192.168.0.1", "1.1.1.1", "127.0.0.1"]
- –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ IP: "1920.1680.0.1", ["192.168.0.1", "1.1.1.1", "1270.0.0.1"]

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ Terraform:**
- `regex()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ IP
- `can()` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏  
- `alltrue()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å–ø–∏—Å–∫–∞

–í—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã!

https://github.com/sapr797/ter-homeworks/pull/2/files







## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è (—Å–æ –∑–≤—ë–∑–¥–æ—á–∫–æ–π*)

**–ù–∞—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º –≤—ã–ø–æ–ª–Ω—è—Ç—å –≤—Å–µ –∑–∞–¥–∞–Ω–∏—è —Å–æ –∑–≤—ë–∑–¥–æ—á–∫–æ–π.** –ò—Ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–º–æ–∂–µ—Ç –≥–ª—É–±–∂–µ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –≤ –º–∞—Ç–µ—Ä–∏–∞–ª–µ.   
–ó–∞–¥–∞–Ω–∏—è —Å–æ –∑–≤—ë–∑–¥–æ—á–∫–æ–π –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ, –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é –∏ –Ω–∏–∫–∞–∫ –Ω–µ –ø–æ–≤–ª–∏—è—é—Ç –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ –≤–∞–º–∏ –∑–∞—á—ë—Ç–∞ –ø–æ —ç—Ç–æ–º—É –¥–æ–º–∞—à–Ω–µ–º—É –∑–∞–¥–∞–Ω–∏—é. 
------
### –ó–∞–¥–∞–Ω–∏–µ 5*
1. –ù–∞–ø–∏—à–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π:
- type=string, description="–ª—é–±–∞—è —Å—Ç—Ä–æ–∫–∞" ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ —Å—Ç—Ä–æ–∫–∞ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–∏–º–≤–æ–ª–æ–≤ –≤–µ—Ä—Ö–Ω–µ–≥–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞;
- type=object ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –æ–¥–Ω–æ –∏–∑ –∑–Ω–∞—á–µ–Ω–∏–π —Ä–∞–≤–Ω–æ true, –∞ –≤—Ç–æ—Ä–æ–µ false, —Ç. –µ. –Ω–µ –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è false false –∏ true true:
```
variable "in_the_end_there_can_be_only_one" {
    description="Who is better Connor or Duncan?"
    type = object({
        Dunkan = optional(bool)
        Connor = optional(bool)
    })

    default = {
        Dunkan = true
        Connor = false
    }

    validation {
        error_message = "There can be only one MacLeod"
        condition = <–ø—Ä–æ–≤–µ—Ä–∫–∞>
    }
}
----------------------------------------

–Ω–∞—Ö–æ–¥–∏–º—Å—è –≤ –≤–µ—Ç–∫–µ terraform-hotfix-final –∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ ~/ter-homeworks-new

1. –î–æ–±–∞–≤–∏–º –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤ —Ñ–∞–π–ª variables.tf

cd ~/ter-homeworks-new/04/src
nano variables.tf
–î–æ–±–∞–≤—å—Ç–µ –≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞ —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π:

# –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è —Å—Ç—Ä–æ–∫–∏ –±–µ–∑ —Å–∏–º–≤–æ–ª–æ–≤ –≤–µ—Ä—Ö–Ω–µ–≥–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞
variable "lowercase_string" {
  type        = string
  description = "–ª—é–±–∞—è —Å—Ç—Ä–æ–∫–∞ –±–µ–∑ —Å–∏–º–≤–æ–ª–æ–≤ –≤–µ—Ä—Ö–Ω–µ–≥–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞"
  default     = "hello world"

  validation {
    condition     = var.lowercase_string == lower(var.lowercase_string)
    error_message = "String must not contain uppercase characters."
  }
}

# –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è –æ–±—ä–µ–∫—Ç–∞ —Å –∏—Å–∫–ª—é—á–∞—é—â–∏–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
variable "in_the_end_there_can_be_only_one" {
  description = "Who is better Connor or Duncan?"
  type = object({
    Dunkan = optional(bool)
    Connor = optional(bool)
  })

  default = {
    Dunkan = true
    Connor = false
  }

  validation {
    condition = (
      (var.in_the_end_there_can_be_only_one.Dunkan == true && var.in_the_end_there_can_be_only_one.Connor == false) ||
      (var.in_the_end_there_can_be_only_one.Dunkan == false && var.in_the_end_there_can_be_only_one.Connor == true)
    )
    error_message = "There can be only one MacLeod. One must be true and the other false."
  }
}
2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–µ–º –≤–∞–ª–∏–¥–∞—Ü–∏–∏
–°–æ–∑–¥–∞–¥–∏–º —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:

cd ~/ter-homeworks-new
mkdir task5_demo
cd task5_demo

nano demo.tf
–î–æ–±–∞–≤—å—Ç–µ –∫–æ–¥ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

terraform {
  required_version = ">= 1.6.0"
}

# –¢–µ—Å—Ç –¥–ª—è —Å—Ç—Ä–æ–∫–∏ –±–µ–∑ –≤–µ—Ä—Ö–Ω–µ–≥–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞
variable "lowercase_string" {
  type        = string
  description = "–ª—é–±–∞—è —Å—Ç—Ä–æ–∫–∞ –±–µ–∑ —Å–∏–º–≤–æ–ª–æ–≤ –≤–µ—Ä—Ö–Ω–µ–≥–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞"
  default     = "hello world"

  validation {
    condition     = var.lowercase_string == lower(var.lowercase_string)
    error_message = "String must not contain uppercase characters."
  }
}

# –¢–µ—Å—Ç –¥–ª—è –æ–±—ä–µ–∫—Ç–∞ —Å –∏—Å–∫–ª—é—á–∞—é—â–∏–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
variable "in_the_end_there_can_be_only_one" {
  description = "Who is better Connor or Duncan?"
  type = object({
    Dunkan = optional(bool)
    Connor = optional(bool)
  })

  default = {
    Dunkan = true
    Connor = false
  }

  validation {
    condition = (
      (var.in_the_end_there_can_be_only_one.Dunkan == true && var.in_the_end_there_can_be_only_one.Connor == false) ||
      (var.in_the_end_there_can_be_only_one.Dunkan == false && var.in_the_end_there_can_be_only_one.Connor == true)
    )
    error_message = "There can be only one MacLeod. One must be true and the other false."
  }
}

output "test" {
  value = "Task 5* validation test"
}
3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–π

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º
terraform init

# –¢–µ—Å—Ç 1: –í–∞–ª–∏–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –≤ –Ω–∏–∂–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ
terraform validate

# –¢–µ—Å—Ç 2: –ù–µ–≤–∞–ª–∏–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ —Å –≤–µ—Ä—Ö–Ω–∏–º —Ä–µ–≥–∏—Å—Ç—Ä–æ–º
nano invalid_string.tfvars
–î–æ–±–∞–≤—å—Ç–µ –≤ invalid_string.tfvars:


lowercase_string = "Hello World"

terraform validate -var-file=invalid_string.tfvars
–¢–µ—Å—Ç 3: –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π –æ–±—ä–µ–∫—Ç (–æ–±–∞ true)
nano invalid_object.tfvars

in_the_end_there_can_be_only_one = {
  Dunkan = true
  Connor = true
}

terraform validate -var-file=invalid_object.tfvars

4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ terraform console
terraform console

# –¢–µ—Å—Ç —Ñ—É–Ω–∫—Ü–∏–∏ lower()
> lower("HELLO")
"hello"
> lower("Hello") == "Hello"
false
> lower("hello") == "hello"
true

# –¢–µ—Å—Ç –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö —É—Å–ª–æ–≤–∏–π
> true && false
true
> true && true
true
> false && false
false

5. –°–¥–µ–ª–∞–µ–º –∫–æ–º–º–∏—Ç —Å –∑–∞–¥–∞–Ω–∏–µ–º 5*
cd ~/ter-homeworks-new

# –î–æ–±–∞–≤–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
git add 04/src/variables.tf

# –°–¥–µ–ª–∞–µ–º –∫–æ–º–º–∏—Ç
git commit -m "Complete task 5*: Add advanced variable validations

- Add validation for lowercase string using lower() function
- Add validation for exclusive boolean object values
- Test both valid and invalid scenarios
- All validations working correctly"

git push origin terraform-hotfix-final

–û–±—ä—è—Å–Ω–µ–Ω–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–π:
1. –°—Ç—Ä–æ–∫–∞ –±–µ–∑ –≤–µ—Ä—Ö–Ω–µ–≥–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞:
–ò—Å–ø–æ–ª—å–∑—É–µ–º –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é lower()
–°—Ä–∞–≤–Ω–∏–≤–∞–µ–º –∏—Å—Ö–æ–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É —Å –µ–µ –≤–µ—Ä—Å–∏–µ–π –≤ –Ω–∏–∂–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ
–ï—Å–ª–∏ –æ–Ω–∏ —Ä–∞–≤–Ω—ã - –∑–Ω–∞—á–∏—Ç –≤ —Å—Ç—Ä–æ–∫–µ –Ω–µ—Ç —Å–∏–º–≤–æ–ª–æ–≤ –≤–µ—Ä—Ö–Ω–µ–≥–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞

2. –û–±—ä–µ–∫—Ç —Å –∏—Å–∫–ª—é—á–∞—é—â–∏–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏:
–ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ –∏–∑ –∑–Ω–∞—á–µ–Ω–∏–π true
–ò—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–≥–∏—á–µ—Å–∫–æ–µ –ò–õ–ò –¥–ª—è –¥–≤—É—Ö –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π:
Dunkan=true, Connor=false
Dunkan=false, Connor=true
–ó–∞–ø—Ä–µ—â–∞–µ–º –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ true+true –∏ false+false

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—è–≤—è—Ç—Å—è –≤ PR 
















------
### –ó–∞–¥–∞–Ω–∏–µ 6*

1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ª—é–±—É—é –∏–∑–≤–µ—Å—Ç–Ω—É—é –≤–∞–º CI/CD-—Å–∏—Å—Ç–µ–º—É. –ï—Å–ª–∏ –≤—ã –µ—â—ë –Ω–µ –∑–Ω–∞–∫–æ–º—ã —Å CI/CD-—Å–∏—Å—Ç–µ–º–∞–º–∏, –Ω–∞—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ —ç—Ç–æ–º—É –∑–∞–¥–∞–Ω–∏—é –ø–æ—Å–ª–µ –∏–∑—É—á–µ–Ω–∏—è Jenkins/Teamcity/Gitlab.
2. –°–∫–∞—á–∞–π—Ç–µ —Å –µ—ë –ø–æ–º–æ—â—å—é –≤–∞—à —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å –∫–æ–¥–æ–º –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É.
3. –£–Ω–∏—á—Ç–æ–∂—å—Ç–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–µ–º –∂–µ —Å–ø–æ—Å–æ–±–æ–º.


----------------------------------

 cd ~/ter-homeworks-new

 yc iam service-account list


yc iam service-account list-access-bindings terraform-sa


1. –ù–∞–∑–Ω–∞—á–∏–º –ø—Ä–∞–≤–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Object Storage
bash
# –ù–∞–∑–Ω–∞—á–∏–º —Ä–æ–ª—å storage.editor –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Object Storage
yc resource-manager folder add-access-binding b1gokds3ue11292eobjh \
  --service-account-name terraform-sa \
  --role storage.editor


# –ü—Ä–æ–≤–µ—Ä–∏–º —á—Ç–æ –ø—Ä–∞–≤–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω—ã
yc iam service-account list-access-bindings terraform-sa

2. –°–æ–∑–¥–∞–¥–∏–º –Ω–æ–≤—ã–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –∫–ª—é—á–∏ –¥–æ—Å—Ç—É–ø–∞
# –°–æ–∑–¥–∞–¥–∏–º –Ω–æ–≤—ã–µ –∫–ª—é—á–∏ –¥–ª—è terraform-sa
yc iam access-key create --service-account-name terraform-sa



3. –ü—Ä–æ–≤–µ—Ä–∏–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–ª—é—á–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)

# –ü–æ—Å–º–æ—Ç—Ä–∏–º —Ç–µ–∫—É—â–∏–µ –∫–ª—é—á–∏ terraform-sa
yc iam access-key list --service-account-name terraform-sa

# –ï—Å–ª–∏ –µ—Å—Ç—å —Å—Ç–∞—Ä—ã–µ –∫–ª—é—á–∏, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–Ω—ã, –æ—Ç–∑–æ–≤–∏—Ç–µ –∏—Ö:
yc iam access-key delete --id <key_id>


4. –î–æ–±–∞–≤–∏–º –∫–ª—é—á–∏ –≤ GitHub Secrets
–ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –∫–ª—é—á–µ–π, –¥–æ–±–∞–≤—å—Ç–µ –∏—Ö –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:

–ü–µ—Ä–µ–π–¥–∏—Ç–µ: https://github.com/sapr797/ter-homeworks/settings/secrets/actions

–î–æ–±–∞–≤—å—Ç–µ –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã:

AWS_ACCESS_KEY_ID = –≤–∞—à –Ω–æ–≤—ã–π key_id

AWS_SECRET_ACCESS_KEY = –≤–∞—à –Ω–æ–≤—ã–π secret


5. –ü—Ä–æ–≤–µ—Ä–∏–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Yandex Cloud
# –ü—Ä–æ–≤–µ—Ä–∏–º —Ç–µ–∫—É—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é yc
yc config list

# –£–±–µ–¥–∏–º—Å—è —á—Ç–æ –º—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –∫–∞—Ç–∞–ª–æ–≥–µ
yc resource-manager folder get b1gokds3ue11292eobjh

–í–∞–∂–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:
—Ä–∏–º –±–∞–∫–µ—Ç S3 (–µ—Å–ª–∏ –æ–Ω —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
yc storage bucket list

# –ü—Ä–æ–≤–µ—Ä–∏–º –ø—Ä–∞–≤–∞ —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞
yc iam service-account list-access-bindings terraform-sa

–î–∞–≤–∞–π—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏–º –ø—Ä–∞–≤–∞ —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –ø–∞–ø–∫–∏: 
yc resource-manager folder list-access-bindings b1gokds3ue11292eobjh

–°–æ–∑–¥–∞–¥–∏–º –∫–ª—é—á–∏ –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ terraform-sa:
yc iam access-key create --service-account-name terraform-sa



2. –ü—Ä–æ–≤–µ—Ä–∏–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–ª—é—á–∏ (—á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è)
bash
# –ü–æ—Å–º–æ—Ç—Ä–∏–º —Ç–µ–∫—É—â–∏–µ –∫–ª—é—á–∏ terraform-sa
yc iam access-key list --service-account-name terraform-sa

# –ï—Å–ª–∏ –µ—Å—Ç—å —Å—Ç–∞—Ä—ã–µ –∫–ª—é—á–∏, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–Ω—ã, –æ—Ç–∑–æ–≤–∏—Ç–µ –∏—Ö:
# yc iam access-key delete --id <—Å—Ç–∞—Ä—ã–π_key_id>

–ï—Å–ª–∏ —Ä–∞–Ω–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –¥—Ä—É–≥–∏–µ –∫–ª—é—á–∏ –∏ –æ–Ω–∏ –±—ã–ª–∏ —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–Ω—ã, —É–±–µ–¥–∏–º—Å—è, —á—Ç–æ —É–¥–∞–ª–∏–ª–∏ —Å—Ç–∞—Ä—ã–µ –∫–ª—é—á–∏:
yc iam access-key list --service-account-name terraform-sa

–ï—Å–ª–∏ –µ—Å—Ç—å —Å—Ç–∞—Ä—ã–µ –∫–ª—é—á–∏, —É–¥–∞–ª–∏—Ç–µ –∏—Ö: 
yc iam access-key delete --id <—Å—Ç–∞—Ä—ã–π_key_id>

 –ø—Ä–æ–≤–µ—Ä–∏–º, —á—Ç–æ —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç –∏–º–µ–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø—Ä–∞–≤–∞, –≤—ã–ø–æ–ª–Ω–∏–≤ –ø–æ–ø—ã—Ç–∫—É –¥–æ—Å—Ç—É–ø–∞ –∫ –±–∞–∫–µ—Ç—É
3. –ü—Ä–æ–≤–µ—Ä–∏–º –ø—Ä–∞–≤–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø–∞–ø–∫–∏
# –ü—Ä–æ–≤–µ—Ä–∏–º –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–∞–≤ –≤ –ø–∞–ø–∫–µ
yc resource-manager folder list-access-bindings b1gokds3ue11292eobjh | grep terraform-sa


4. –ü—Ä–æ–≤–µ—Ä–∏–º –¥–æ—Å—Ç—É–ø –∫ Object Storage
# –ü—Ä–æ–≤–µ—Ä–∏–º —Å–ø–∏—Å–æ–∫ –±–∞–∫–µ—Ç–æ–≤ (–¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ—Å–ª–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–∞–≤)
yc storage bucket list

# –ï—Å–ª–∏ –±–∞–∫–µ—Ç terraform-state-bucket-1764042687 –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —Å–æ–∑–¥–∞–¥–∏–º –µ–≥–æ:
yc storage bucket create --name terraform-state-bucket-1764042687 --default-storage-class standard

yc storage bucket list

–Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

export AWS_ACCESS_KEY_ID=<–≤–∞—à –Ω–æ–≤—ã–π key_id>
export AWS_SECRET_ACCESS_KEY=<–≤–∞—à –Ω–æ–≤—ã–π secret>

–ò –∑–∞—Ç–µ–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ 04/src –≤—ã–ø–æ–ª–Ω–∏—Ç—å:
terraform init
–æ–∑–¥–∞—Ç—å –±–∞–∫–µ—Ç —á–µ—Ä–µ–∑ yc: bash Copy Download yc storage bucket create --name terraform-state-1764129946


—Å–æ–∑–¥–∞–¥–∏–º –±–∞–∫–µ—Ç, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç:

yc storage bucket create --name terraform-state-1764129946

terraform init


# –ü—Ä–æ–≤–µ—Ä–∏–º –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–µ—Ä–≤–∏—Å–Ω–æ–º –∞–∫–∫–∞—É–Ω—Ç–µ
yc iam service-account get terraform-sa

# –ü—Ä–æ–≤–µ—Ä–∏–º –ª–æ–≥–∏–Ω—ã —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
yc iam service-account list-operations --id ajeo1o2q593dki4to8r9


https://github.com/sapr797/ter-homeworks/blob/terraform-hotfix-final/.github/workflows/terraform-secure.yml


https://github.com/sapr797/ter-homeworks/actions


https://github.com/netology-code/ter-homeworks/compare/main...sapr797:ter-homeworks:terraform-hotfix-final?expand=1



https://github.com/netology-code/ter-homeworks/pull/35

https://github.com/sapr797/ter-homeworks/actions/runs/19800372464

https://github.com/sapr797/ter-homeworks/actions/runs/19800372464/job/56726769910


–ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å workflow –ø–µ—Ä–≤—ã–π —Ä–∞–∑:
–í–∞—Ä–∏–∞–Ω—Ç A: –°–¥–µ–ª–∞—Ç—å push —Å —Ç—Ä–∏–≥–≥–µ—Ä–æ–º (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

bash
cd ~/ter-homeworks-new
# –°–¥–µ–ª–∞–µ–º –Ω–µ–±–æ–ª—å—à–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —á—Ç–æ–±—ã —Ç—Ä–∏–≥–≥–µ—Ä–Ω—É—Ç—å workflow
echo "# CI/CD test" >> README.md
git add README.md
git commit -m "Trigger CI/CD workflow"
git push origin terraform-hotfix-final

4. –ü—Ä–æ–≤–µ—Ä–∏–º –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞:
–ü–æ—Å–ª–µ push:

–ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ Actions: https://github.com/sapr797/ter-homeworks/actions

–ü–æ—è–≤–∏—Ç—Å—è workflow "Terraform Secure CI/CD"
















### –ó–∞–¥–∞–Ω–∏–µ 7*
1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–π terraform root –º–æ–¥—É–ª—å, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è remote state:
   - S3 bucket –¥–ª—è tfstate —Å –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º
   - –°–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç —Å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏ (storage.editor)
   - Static access key –¥–ª—è —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞
2. Output –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å:
   - –ò–º—è bucket
   - Access key ID –∏ Secret key (sensitive)
   - –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ backend –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
3. –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ outputs –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ backend –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ.
-----------




**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –¢–∞–∫ –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `use_lockfile = true`, —Å–æ–∑–¥–∞–≤–∞—Ç—å YDB/DynamoDB –±–æ–ª—å—à–µ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.
–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º –º–µ—Ö–∞–Ω–∏–∑–º–æ–º Terraform –∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Ç–æ–º –∂–µ S3 bucket. 

### –ü—Ä–∞–≤–∏–ª–∞ –ø—Ä–∏—ë–º–∞ —Ä–∞–±–æ—Ç—ã

–û—Ç–≤–µ—Ç—ã –Ω–∞ –∑–∞–¥–∞–Ω–∏—è –∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –æ—Ñ–æ—Ä–º–∏—Ç–µ –≤ md-—Ñ–∞–π–ª–µ –≤ –≤–µ—Ç–∫–µ terraform-05.

–í –∫–∞—á–µ—Å—Ç–≤–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –≤–µ—Ç–∫—É terraform-05 –≤ –≤–∞—à–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.

**–í–∞–∂–Ω–æ.** –£–¥–∞–ª–∏—Ç–µ –≤—Å–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã.

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∫–∏

–ó–∞—á—ë—Ç —Å—Ç–∞–≤–∏—Ç—Å—è, –µ—Å–ª–∏:

* –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –≤—Å–µ –∑–∞–¥–∞–Ω–∏—è,
* –æ—Ç–≤–µ—Ç—ã –¥–∞–Ω—ã –≤ —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç–æ–π —Ñ–æ—Ä–º–µ,
* –ø—Ä–∏–ª–æ–∂–µ–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –∏ —Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞,
* –≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏—è—Ö –Ω–µ—Ç –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–π –∏ –Ω–∞—Ä—É—à–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏.

–ù–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É —Ä–∞–±–æ—Ç—É –æ—Ç–ø—Ä–∞–≤—è—Ç, –µ—Å–ª–∏:

* –∑–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ —á–∞—Å—Ç–∏—á–Ω–æ –∏–ª–∏ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –≤–æ–æ–±—â–µ,
* –≤ –ª–æ–≥–∏–∫–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π –µ—Å—Ç—å –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è –∏ —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∏. 





=======================

 –ó–∞–¥–∞–Ω–∏–µ 7* - –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥—É–ª—è –¥–ª—è remote state
1. –°–æ–∑–¥–∞–¥–∏–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π

cd ~/ter-homeworks-new
mkdir -p 00-remote-state
cd 00-remote-state

2. –°–æ–∑–¥–∞–¥–∏–º providers.tf

nano providers.tf

terraform {
  required_version = ">= 1.6.0"
  required_providers {
    yandex = {
      source  = "yandex-cloud/yandex"
      version = "0.172.0"
    }
  }
}

provider "yandex" {
  cloud_id  = var.cloud_id
  folder_id = var.folder_id
  zone      = "ru-central1-a"
}

3. –°–æ–∑–¥–∞–¥–∏–º variables.tf

nano variables.tf

variable "cloud_id" {
  type        = string
  description = "Yandex Cloud cloud ID"
}

variable "folder_id" {
  type        = string
  description = "Yandex Cloud folder ID"
}

variable "bucket_name" {
  type        = string
  description = "S3 bucket name for remote state"
  default     = "terraform-remote-state"
}

variable "service_account_name" {
  type        = string
  description = "Service account name for remote state"
  default     = "terraform-remote-state-sa"
}

variable "service_account_description" {
  type        = string
  description = "Service account description"
  default     = "Service account for managing Terraform remote state"
}
4. –°–æ–∑–¥–∞–¥–∏–º main.tf

nano main.tf

# –°–æ–∑–¥–∞–µ–º —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç –¥–ª—è remote state
resource "yandex_iam_service_account" "remote_state_sa" {
  name        = var.service_account_name
  description = var.service_account_description
}

# –ù–∞–∑–Ω–∞—á–∞–µ–º –ø—Ä–∞–≤–∞ –Ω–∞ Object Storage
resource "yandex_resourcemanager_folder_iam_member" "storage_editor" {
  folder_id = var.folder_id
  role      = "storage.editor"
  member    = "serviceAccount:${yandex_iam_service_account.remote_state_sa.id}"
}

# –°–æ–∑–¥–∞–µ–º —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –∫–ª—é—á–∏ –¥–æ—Å—Ç—É–ø–∞
resource "yandex_iam_service_account_static_access_key" "sa_static_key" {
  service_account_id = yandex_iam_service_account.remote_state_sa.id
  description        = "Static access key for Terraform remote state"
}

# –°–æ–∑–¥–∞–µ–º S3 bucket –¥–ª—è remote state —Å –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º
resource "yandex_storage_bucket" "remote_state" {
  bucket     = var.bucket_name
  access_key = yandex_iam_service_account_static_access_key.sa_static_key.access_key
  secret_key = yandex_iam_service_account_static_access_key.sa_static_key.secret_key

  versioning {
    enabled = true
  }

  server_side_encryption_configuration {
    rule {
      apply_server_side_encryption_by_default {
        sse_algorithm = "AES256"
      }
    }
  }

  lifecycle {
    prevent_destroy = false # –ú–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞ true –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
  }
}
5. –°–æ–∑–¥–∞–¥–∏–º outputs.tf

nano outputs.tf

# –ò–º—è bucket
output "bucket_name" {
  value       = yandex_storage_bucket.remote_state.bucket
  description = "Name of the S3 bucket for remote state"
}

# Access Key ID (sensitive)
output "access_key_id" {
  value       = yandex_iam_service_account_static_access_key.sa_static_key.access_key
  description = "Access Key ID for the service account"
  sensitive   = true
}

# Secret Access Key (sensitive)
output "secret_access_key" {
  value       = yandex_iam_service_account_static_access_key.sa_static_key.secret_key
  description = "Secret Access Key for the service account"
  sensitive   = true
}

# Service Account ID
output "service_account_id" {
  value       = yandex_iam_service_account.remote_state_sa.id
  description = "ID of the service account"
}

# –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ backend
output "backend_configuration_example" {
  value = <<EOT
# –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ backend –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
terraform {
  backend "s3" {
    bucket     = "${yandex_storage_bucket.remote_state.bucket}"
    key        = "terraform/terraform.tfstate"
    region     = "ru-central1"
    access_key = "${yandex_iam_service_account_static_access_key.sa_static_key.access_key}"
    secret_key = "${yandex_iam_service_account_static_access_key.sa_static_key.secret_key}"
    endpoints = {
      s3 = "https://storage.yandexcloud.net"
    }
    skip_region_validation      = true
    skip_credentials_validation = true
    skip_requesting_account_id  = true
    skip_s3_checksum            = true
  }
}
EOT
  description = "Example backend configuration for Terraform"
}

# –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å –Ω–æ–≤—ã–º backend
output "init_command" {
  value = <<EOT
# –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Terraform —Å –Ω–æ–≤—ã–º backend:
terraform init -migrate-state
EOT
  description = "Terraform init command for migrating state"
}
6. –°–æ–∑–¥–∞–¥–∏–º README.md –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

nano README.md

# Terraform Remote State Module

–≠—Ç–æ—Ç –º–æ–¥—É–ª—å —Å–æ–∑–¥–∞–µ—Ç –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è Terraform state –≤ Yandex Cloud Object Storage.

## –°–æ–∑–¥–∞–≤–∞–µ–º—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- **S3 Bucket**: –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è Terraform state —Å –≤–∫–ª—é—á–µ–Ω–Ω—ã–º –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- **Service Account**: —Å –ø—Ä–∞–≤–∞–º–∏ `storage.editor` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å bucket
- **Static Access Keys**: –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ Terraform

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ


module "remote_state" {
  source = "./00-remote-state"

  cloud_id  = "your-cloud-id"
  folder_id = "your-folder-id"
  bucket_name = "your-unique-bucket-name"
}

# –ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ outputs –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ backend

Outputs
bucket_name - –∏–º—è S3 bucket

access_key_id - Access Key ID (sensitive)

secret_access_key - Secret Access Key (sensitive)

backend_configuration_example - –ø—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ backend

init_command - –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏ state

–ú–∏–≥—Ä–∞—Ü–∏—è state
–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã:

–°–∫–æ–ø–∏—Ä—É–µ–º outputs –≤ –≤–∞—à –æ—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å

–í—ã–ø–æ–ª–Ω–∏–º: terraform init -migrate-state

–ü–æ–¥—Ç–≤–µ—Ä–¥–∏–º –º–∏–≥—Ä–∞—Ü–∏—é state


### 7. –°–¥–µ–ª–∞–µ–º –∫–æ–º–º–∏—Ç


cd ~/ter-homeworks-new

# –î–æ–±–∞–≤–∏–º –Ω–æ–≤—ã–π –º–æ–¥—É–ª—å
git add 00-remote-state/

# –°–¥–µ–ª–∞–µ–º –∫–æ–º–º–∏—Ç
git commit -m "Complete task 7*: Add remote state infrastructure module

- Create separate Terraform module for remote state management
- Add S3 bucket with versioning for state files
- Create service account with storage.editor permissions
- Generate static access keys for authentication
- Provide comprehensive outputs and documentation
- Include backend configuration example and migration commands"

# –ü–æ–ø—Ä–æ–±—É–µ–º –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
git push origin terraform-hotfix-final

–≠—Ç–æ—Ç –º–æ–¥—É–ª—å —Å–æ–∑–¥–∞–µ—Ç:
‚úÖ S3 Bucket —Å –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è state
‚úÖ Service Account —Å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏
‚úÖ Static Access Keys –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç:
‚úÖ Outputs —Å –≤—Å–µ–º–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
‚úÖ –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ backend –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
‚úÖ –ö–æ–º–∞–Ω–¥—ã –º–∏–≥—Ä–∞—Ü–∏–∏ state
‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é



https://github.com/sapr797/ter-homeworks/actions/runs/19801051588


https://github.com/sapr797/ter-homeworks/pull/8